#!/usr/bin/env bash
# Create nginx user and group if they do not exist
if ! id -u nginx > /dev/null 2>&1; then
    useradd -r -s /sbin/nologin nginx
fi

# Update Nginx configuration to run as nginx user on port 8080
sed -i 's/^user .*/user nginx;/' /etc/nginx/nginx.conf
sed -i 's/listen 80;/listen 8080;/' /etc/nginx/sites-available/default
sed -i 's/listen \[::\]:80;/listen \[::\]:8080;/' /etc/nginx/sites-available/default

# Ensure permissions are set correctly
chown -R nginx:nginx /var/lib/nginx /var/log/nginx /var/www/html

# Restart Nginx service
service nginx restart
